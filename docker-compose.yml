services:
  claw-hive-dashboard:
    build: ./dashboard
    ports:
      - "100.99.29.88:4100:3000"
    volumes:
      - ${HIVE_DATA_DIR:-./hive-data}:/app/data/hive:rw
      - ./cli:/app/cli:ro
      - ${WORKSPACE_DIR:-/home/openclaw/workspace}:/app/workspace:rw
    environment:
      - HIVE_DATA_PATH=/app/data/hive
      - WORKSPACE_PATH=/app/workspace
      - HOSTNAME=0.0.0.0
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - XAI_API_KEY=${XAI_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3

  poll-relay:
    build:
      context: .
      dockerfile: poll-relay/Dockerfile
    volumes:
      - ${HIVE_DATA_DIR}:/hive-data:rw
      - /var/run/docker.sock:/var/run/docker.sock
    group_add:
      - "${DOCKER_GID}"
    environment:
      HIVE_DATA_DIR: /hive-data
      HIVE_CLI: /app/cli/hive-cli.js
      BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      CHAT_ID: ${TELEGRAM_CHAT_ID}
      THREAD_ID: ${TELEGRAM_THREAD_ID}
      GATEWAY_CONTAINER: ${GATEWAY_CONTAINER:-openclaw-gateway-1}
    restart: unless-stopped

